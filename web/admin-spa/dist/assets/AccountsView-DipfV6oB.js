import{r as b,aR as he,o as K,V as Te,x as u,y as i,z as e,L as $,K as T,al as pe,aY as X,aX as ye,aq as z,aZ as $e,C as E,O as y,c as Z,P as A,I as ee,a5 as ge,R as le,an as J,u as D,q as Ce,Y as Ae,Q as Ue,ac as _e,B as Ie}from"./vue-vendor-YmkKLAOK.js";import{s as V}from"./toast-BvwA7Mwb.js";import{a as M,_ as je}from"./index-BiAIsnvb.js";import"./element-plus-D-FTEVKS.js";import"./vendor-BDiMbLwQ.js";const se=b(!1),fe=b({title:"",message:"",confirmText:"继续",cancelText:"取消"}),Y=b(null);function be(){return{showConfirmModal:se,confirmOptions:fe,showConfirm:(v,p,C="继续",k="取消")=>new Promise(g=>{fe.value={title:v,message:p,confirmText:C,cancelText:k},Y.value=g,se.value=!0}),handleConfirm:()=>{se.value=!1,Y.value&&(Y.value(!0),Y.value=null)},handleCancel:()=>{se.value=!1,Y.value&&(Y.value(!1),Y.value=null)}}}const we=he("accounts",()=>{const R=b([]),L=b([]),r=b(!1),v=b(null),p=b(""),C=b("asc"),k=async()=>{r.value=!0,v.value=null;try{const m=await M.get("/admin/claude-accounts");if(m.success)R.value=m.data||[];else throw new Error(m.message||"获取Claude账户失败")}catch(m){throw v.value=m.message,m}finally{r.value=!1}},g=async()=>{r.value=!0,v.value=null;try{const m=await M.get("/admin/gemini-accounts");if(m.success)L.value=m.data||[];else throw new Error(m.message||"获取Gemini账户失败")}catch(m){throw v.value=m.message,m}finally{r.value=!1}};return{claudeAccounts:R,geminiAccounts:L,loading:r,error:v,sortBy:p,sortOrder:C,fetchClaudeAccounts:k,fetchGeminiAccounts:g,fetchAllAccounts:async()=>{r.value=!0,v.value=null;try{await Promise.all([k(),g()])}catch(m){throw v.value=m.message,m}finally{r.value=!1}},createClaudeAccount:async m=>{r.value=!0,v.value=null;try{const d=await M.post("/admin/claude-accounts",m);if(d.success)return await k(),d.data;throw new Error(d.message||"创建Claude账户失败")}catch(d){throw v.value=d.message,d}finally{r.value=!1}},createGeminiAccount:async m=>{r.value=!0,v.value=null;try{const d=await M.post("/admin/gemini-accounts",m);if(d.success)return await g(),d.data;throw new Error(d.message||"创建Gemini账户失败")}catch(d){throw v.value=d.message,d}finally{r.value=!1}},updateClaudeAccount:async(m,d)=>{r.value=!0,v.value=null;try{const h=await M.put(`/admin/claude-accounts/${m}`,d);if(h.success)return await k(),h;throw new Error(h.message||"更新Claude账户失败")}catch(h){throw v.value=h.message,h}finally{r.value=!1}},updateGeminiAccount:async(m,d)=>{r.value=!0,v.value=null;try{const h=await M.put(`/admin/gemini-accounts/${m}`,d);if(h.success)return await g(),h;throw new Error(h.message||"更新Gemini账户失败")}catch(h){throw v.value=h.message,h}finally{r.value=!1}},toggleAccount:async(m,d)=>{r.value=!0,v.value=null;try{const h=m==="claude"?`/admin/claude-accounts/${d}/toggle`:`/admin/gemini-accounts/${d}/toggle`,W=await M.put(h);if(W.success)return m==="claude"?await k():await g(),W;throw new Error(W.message||"切换状态失败")}catch(h){throw v.value=h.message,h}finally{r.value=!1}},deleteAccount:async(m,d)=>{r.value=!0,v.value=null;try{const h=m==="claude"?`/admin/claude-accounts/${d}`:`/admin/gemini-accounts/${d}`,W=await M.delete(h);if(W.success)return m==="claude"?await k():await g(),W;throw new Error(W.message||"删除失败")}catch(h){throw v.value=h.message,h}finally{r.value=!1}},refreshClaudeToken:async m=>{r.value=!0,v.value=null;try{const d=await M.post(`/admin/claude-accounts/${m}/refresh`);if(d.success)return await k(),d;throw new Error(d.message||"Token刷新失败")}catch(d){throw v.value=d.message,d}finally{r.value=!1}},generateClaudeAuthUrl:async m=>{try{const d=await M.post("/admin/claude-accounts/generate-auth-url",m);if(d.success)return d.data;throw new Error(d.message||"生成授权URL失败")}catch(d){throw v.value=d.message,d}},exchangeClaudeCode:async m=>{try{const d=await M.post("/admin/claude-accounts/exchange-code",m);if(d.success)return d.data;throw new Error(d.message||"交换授权码失败")}catch(d){throw v.value=d.message,d}},generateGeminiAuthUrl:async m=>{try{const d=await M.post("/admin/gemini-accounts/generate-auth-url",m);if(d.success)return d.data;throw new Error(d.message||"生成授权URL失败")}catch(d){throw v.value=d.message,d}},exchangeGeminiCode:async m=>{try{const d=await M.post("/admin/gemini-accounts/exchange-code",m);if(d.success)return d.data;throw new Error(d.message||"交换授权码失败")}catch(d){throw v.value=d.message,d}},sortAccounts:m=>{p.value===m?C.value=C.value==="asc"?"desc":"asc":(p.value=m,C.value="asc")},reset:()=>{R.value=[],L.value=[],r.value=!1,v.value=null,p.value="",C.value="asc"}}}),Ve={class:"space-y-4"},Se={class:"flex items-center justify-between"},Ge={class:"flex items-center cursor-pointer"},Re={key:0,class:"bg-gray-50 p-4 rounded-lg border border-gray-200 space-y-4"},Me={class:"grid grid-cols-2 gap-4"},Pe={class:"space-y-4"},Oe={class:"flex items-center"},Le={key:0,class:"grid grid-cols-2 gap-4"},ze={class:"relative"},Ee=["type"],xe={__name:"ProxyConfig",props:{modelValue:{type:Object,default:()=>({enabled:!1,type:"socks5",host:"",port:"",username:"",password:""})}},emits:["update:modelValue"],setup(R,{emit:L}){const r=R,v=L,p=b({...r.modelValue}),C=b(!!(p.value.username||p.value.password)),k=b(!1);K(()=>r.modelValue,x=>{JSON.stringify(x)!==JSON.stringify(p.value)&&(p.value={...x},C.value=!!(x.username||x.password))},{deep:!0}),K(()=>p.value.enabled,x=>{U()}),K(()=>p.value.type,x=>{U()}),K(()=>p.value.host,x=>{U()}),K(()=>p.value.port,x=>{U()}),K(()=>p.value.username,x=>{U()}),K(()=>p.value.password,x=>{U()}),K(C,x=>{x||(p.value.username="",p.value.password="",U())});let g=null;function U(){g&&clearTimeout(g),g=setTimeout(()=>{const x={...p.value};C.value||(x.username="",x.password=""),v("update:modelValue",x)},100)}return Te(()=>{g&&clearTimeout(g)}),(x,c)=>(i(),u("div",Ve,[e("div",Se,[c[9]||(c[9]=e("h4",{class:"text-sm font-semibold text-gray-700"},"代理设置 (可选)",-1)),e("label",Ge,[T(e("input",{type:"checkbox","onUpdate:modelValue":c[0]||(c[0]=_=>p.value.enabled=_),class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"},null,512),[[pe,p.value.enabled]]),c[8]||(c[8]=e("span",{class:"ml-2 text-sm text-gray-700"},"启用代理",-1))])]),p.value.enabled?(i(),u("div",Re,[c[17]||(c[17]=X('<div class="flex items-start gap-3 mb-3"><div class="w-8 h-8 bg-gray-500 rounded-lg flex items-center justify-center flex-shrink-0"><i class="fas fa-server text-white text-sm"></i></div><div class="flex-1"><p class="text-sm text-gray-700"> 配置代理以访问受限的网络资源。支持 SOCKS5 和 HTTP 代理。 </p><p class="text-xs text-gray-500 mt-1"> 请确保代理服务器稳定可用，否则会影响账户的正常使用。 </p></div></div>',1)),e("div",null,[c[11]||(c[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"代理类型",-1)),T(e("select",{"onUpdate:modelValue":c[1]||(c[1]=_=>p.value.type=_),class:"form-input w-full"},c[10]||(c[10]=[e("option",{value:"socks5"},"SOCKS5",-1),e("option",{value:"http"},"HTTP",-1),e("option",{value:"https"},"HTTPS",-1)]),512),[[ye,p.value.type]])]),e("div",Me,[e("div",null,[c[12]||(c[12]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"主机地址",-1)),T(e("input",{"onUpdate:modelValue":c[2]||(c[2]=_=>p.value.host=_),type:"text",placeholder:"例如: 192.168.1.100",class:"form-input w-full"},null,512),[[z,p.value.host]])]),e("div",null,[c[13]||(c[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"端口",-1)),T(e("input",{"onUpdate:modelValue":c[3]||(c[3]=_=>p.value.port=_),type:"number",placeholder:"例如: 1080",class:"form-input w-full"},null,512),[[z,p.value.port]])])]),e("div",Pe,[e("div",Oe,[T(e("input",{type:"checkbox","onUpdate:modelValue":c[4]||(c[4]=_=>C.value=_),id:"proxyAuth",class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"},null,512),[[pe,C.value]]),c[14]||(c[14]=e("label",{for:"proxyAuth",class:"ml-2 text-sm text-gray-700 cursor-pointer"}," 需要身份验证 ",-1))]),C.value?(i(),u("div",Le,[e("div",null,[c[15]||(c[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"用户名",-1)),T(e("input",{"onUpdate:modelValue":c[5]||(c[5]=_=>p.value.username=_),type:"text",placeholder:"代理用户名",class:"form-input w-full"},null,512),[[z,p.value.username]])]),e("div",null,[c[16]||(c[16]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"密码",-1)),e("div",ze,[T(e("input",{"onUpdate:modelValue":c[6]||(c[6]=_=>p.value.password=_),type:k.value?"text":"password",placeholder:"代理密码",class:"form-input w-full pr-10"},null,8,Ee),[[$e,p.value.password]]),e("button",{type:"button",onClick:c[7]||(c[7]=_=>k.value=!k.value),class:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600"},[e("i",{class:E(k.value?"fas fa-eye-slash":"fas fa-eye")},null,2)])])])])):$("",!0)]),c[18]||(c[18]=e("div",{class:"bg-blue-50 p-3 rounded-lg border border-blue-200"},[e("p",{class:"text-xs text-blue-700"},[e("i",{class:"fas fa-info-circle mr-1"}),e("strong",null,"提示："),y("代理设置将用于所有与此账户相关的API请求。请确保代理服务器支持HTTPS流量转发。 ")])],-1))])):$("",!0)]))}},De={class:"space-y-6"},Ke={key:0},We={class:"bg-blue-50 p-6 rounded-lg border border-blue-200"},qe={class:"flex items-start gap-4"},Be={class:"flex-1"},Ne={class:"space-y-4"},Fe={class:"bg-white/80 rounded-lg p-4 border border-blue-300"},He={class:"flex items-start gap-3"},Je={class:"flex-1"},Ye=["disabled"],Qe={key:0,class:"fas fa-link mr-2"},Xe={key:1,class:"loading-spinner mr-2"},Ze={key:1,class:"space-y-3"},et={class:"flex items-center gap-2"},tt=["value"],st={class:"bg-white/80 rounded-lg p-4 border border-blue-300"},lt={class:"flex items-start gap-3"},at={class:"flex-1"},ot={class:"space-y-3"},nt={key:1},rt={class:"bg-green-50 p-6 rounded-lg border border-green-200"},it={class:"flex items-start gap-4"},ut={class:"flex-1"},dt={class:"space-y-4"},ct={class:"bg-white/80 rounded-lg p-4 border border-green-300"},mt={class:"flex items-start gap-3"},pt={class:"flex-1"},ft=["disabled"],xt={key:0,class:"fas fa-link mr-2"},vt={key:1,class:"loading-spinner mr-2"},yt={key:1,class:"space-y-3"},gt={class:"flex items-center gap-2"},bt=["value"],wt={class:"bg-white/80 rounded-lg p-4 border border-green-300"},kt={class:"flex items-start gap-3"},ht={class:"flex-1"},Tt={class:"space-y-3"},$t={class:"flex gap-3 pt-4"},Ct=["disabled"],At={key:0,class:"loading-spinner mr-2"},Ut={__name:"OAuthFlow",props:{platform:{type:String,required:!0},proxy:{type:Object,default:null}},emits:["success","back"],setup(R,{emit:L}){const r=R,v=L,p=we(),C=b(!1),k=b(!1),g=b(""),U=b(""),x=b(!1),c=b(""),_=Z(()=>g.value&&U.value.trim());K(U,S=>{if(!S||typeof S!="string")return;const o=S.trim();if(!o)return;if(o.startsWith("http://")||o.startsWith("https://"))if(o.startsWith("http://localhost:45462"))try{const q=new URL(o).searchParams.get("code");q?(U.value=q,V("成功提取授权码！","success"),console.log("Successfully extracted authorization code from URL")):V("URL 中未找到授权码参数，请检查链接是否正确","error")}catch(N){console.error("Failed to parse URL:",N),V("链接格式错误，请检查是否为完整的 URL","error")}else if(r.platform==="gemini")try{const q=new URL(o).searchParams.get("code");q&&(U.value=q,V("成功提取授权码！","success"))}catch{}else V("请粘贴以 http://localhost:45462 开头的链接","error")});const P=async()=>{var S;C.value=!0;try{const o=(S=r.proxy)!=null&&S.enabled?{proxy:{type:r.proxy.type,host:r.proxy.host,port:parseInt(r.proxy.port),username:r.proxy.username||null,password:r.proxy.password||null}}:{};if(r.platform==="claude"){const G=await p.generateClaudeAuthUrl(o);g.value=G.authUrl,c.value=G.sessionId}else if(r.platform==="gemini"){const G=await p.generateGeminiAuthUrl(o);g.value=G.authUrl,c.value=G.sessionId}}catch(o){V(o.message||"生成授权链接失败","error")}finally{C.value=!1}},j=()=>{g.value="",U.value="",P()},s=async()=>{try{await navigator.clipboard.writeText(g.value),x.value=!0,V("链接已复制","success"),setTimeout(()=>{x.value=!1},2e3)}catch{const o=document.createElement("input");o.value=g.value,document.body.appendChild(o),o.select(),document.execCommand("copy"),document.body.removeChild(o),x.value=!0,V("链接已复制","success"),setTimeout(()=>{x.value=!1},2e3)}},I=async()=>{var S;if(_.value){k.value=!0;try{let o={};r.platform==="claude"?o={sessionId:c.value,callbackUrl:U.value.trim()}:r.platform==="gemini"&&(o={code:U.value.trim(),sessionId:c.value}),(S=r.proxy)!=null&&S.enabled&&(o.proxy={type:r.proxy.type,host:r.proxy.host,port:parseInt(r.proxy.port),username:r.proxy.username||null,password:r.proxy.password||null});let G;r.platform==="claude"?G=await p.exchangeClaudeCode(o):r.platform==="gemini"&&(G=await p.exchangeGeminiCode(o)),v("success",G)}catch(o){V(o.message||"授权失败，请检查授权码是否正确","error")}finally{k.value=!1}}};return(S,o)=>(i(),u("div",De,[R.platform==="claude"?(i(),u("div",Ke,[e("div",We,[e("div",qe,[o[14]||(o[14]=e("div",{class:"w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center flex-shrink-0"},[e("i",{class:"fas fa-link text-white"})],-1)),e("div",Be,[o[12]||(o[12]=e("h4",{class:"font-semibold text-blue-900 mb-3"},"Claude 账户授权",-1)),o[13]||(o[13]=e("p",{class:"text-sm text-blue-800 mb-4"}," 请按照以下步骤完成 Claude 账户的授权： ",-1)),e("div",Ne,[e("div",Fe,[e("div",He,[o[5]||(o[5]=e("div",{class:"w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0"},"1",-1)),e("div",Je,[o[4]||(o[4]=e("p",{class:"font-medium text-blue-900 mb-2"},"点击下方按钮生成授权链接",-1)),g.value?(i(),u("div",Ze,[e("div",et,[e("input",{type:"text",value:g.value,readonly:"",class:"form-input flex-1 text-xs font-mono bg-gray-50"},null,8,tt),e("button",{onClick:s,class:"px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",title:"复制链接"},[e("i",{class:E(x.value?"fas fa-check text-green-500":"fas fa-copy")},null,2)])]),e("button",{onClick:j,class:"text-xs text-blue-600 hover:text-blue-700"},o[3]||(o[3]=[e("i",{class:"fas fa-sync-alt mr-1"},null,-1),y("重新生成 ",-1)]))])):(i(),u("button",{key:0,onClick:P,disabled:C.value,class:"btn btn-primary px-4 py-2 text-sm"},[C.value?(i(),u("div",Xe)):(i(),u("i",Qe)),y(" "+A(C.value?"生成中...":"生成授权链接"),1)],8,Ye))])])]),o[11]||(o[11]=X('<div class="bg-white/80 rounded-lg p-4 border border-blue-300"><div class="flex items-start gap-3"><div class="w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0">2</div><div class="flex-1"><p class="font-medium text-blue-900 mb-2">在浏览器中打开链接并完成授权</p><p class="text-sm text-blue-700 mb-2"> 请在新标签页中打开授权链接，登录您的 Claude 账户并授权。 </p><div class="bg-yellow-50 p-3 rounded border border-yellow-300"><p class="text-xs text-yellow-800"><i class="fas fa-exclamation-triangle mr-1"></i><strong>注意：</strong>如果您设置了代理，请确保浏览器也使用相同的代理访问授权页面。 </p></div></div></div></div>',1)),e("div",st,[e("div",lt,[o[10]||(o[10]=e("div",{class:"w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0"},"3",-1)),e("div",at,[o[8]||(o[8]=e("p",{class:"font-medium text-blue-900 mb-2"},"输入 Authorization Code",-1)),o[9]||(o[9]=e("p",{class:"text-sm text-blue-700 mb-3"},[y(" 授权完成后，页面会显示一个 "),e("strong",null,"Authorization Code"),y("，请将其复制并粘贴到下方输入框： ")],-1)),e("div",ot,[e("div",null,[o[6]||(o[6]=e("label",{class:"block text-sm font-semibold text-gray-700 mb-2"},[e("i",{class:"fas fa-key text-blue-500 mr-2"}),y("Authorization Code ")],-1)),T(e("textarea",{"onUpdate:modelValue":o[0]||(o[0]=G=>U.value=G),rows:"3",class:"form-input w-full resize-none font-mono text-sm",placeholder:"粘贴从Claude页面获取的Authorization Code..."},null,512),[[z,U.value]])]),o[7]||(o[7]=e("p",{class:"text-xs text-gray-500 mt-2"},[e("i",{class:"fas fa-info-circle mr-1"}),y(" 请粘贴从Claude页面复制的Authorization Code ")],-1))])])])])])])])])])):R.platform==="gemini"?(i(),u("div",nt,[e("div",rt,[e("div",it,[o[26]||(o[26]=e("div",{class:"w-10 h-10 bg-green-500 rounded-lg flex items-center justify-center flex-shrink-0"},[e("i",{class:"fas fa-robot text-white"})],-1)),e("div",ut,[o[24]||(o[24]=e("h4",{class:"font-semibold text-green-900 mb-3"},"Gemini 账户授权",-1)),o[25]||(o[25]=e("p",{class:"text-sm text-green-800 mb-4"}," 请按照以下步骤完成 Gemini 账户的授权： ",-1)),e("div",dt,[e("div",ct,[e("div",mt,[o[17]||(o[17]=e("div",{class:"w-6 h-6 bg-green-600 text-white rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0"},"1",-1)),e("div",pt,[o[16]||(o[16]=e("p",{class:"font-medium text-green-900 mb-2"},"点击下方按钮生成授权链接",-1)),g.value?(i(),u("div",yt,[e("div",gt,[e("input",{type:"text",value:g.value,readonly:"",class:"form-input flex-1 text-xs font-mono bg-gray-50"},null,8,bt),e("button",{onClick:s,class:"px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",title:"复制链接"},[e("i",{class:E(x.value?"fas fa-check text-green-500":"fas fa-copy")},null,2)])]),e("button",{onClick:j,class:"text-xs text-green-600 hover:text-green-700"},o[15]||(o[15]=[e("i",{class:"fas fa-sync-alt mr-1"},null,-1),y("重新生成 ",-1)]))])):(i(),u("button",{key:0,onClick:P,disabled:C.value,class:"btn btn-primary px-4 py-2 text-sm"},[C.value?(i(),u("div",vt)):(i(),u("i",xt)),y(" "+A(C.value?"生成中...":"生成授权链接"),1)],8,ft))])])]),o[23]||(o[23]=X('<div class="bg-white/80 rounded-lg p-4 border border-green-300"><div class="flex items-start gap-3"><div class="w-6 h-6 bg-green-600 text-white rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0">2</div><div class="flex-1"><p class="font-medium text-green-900 mb-2">在浏览器中打开链接并完成授权</p><ol class="text-sm text-green-800 space-y-1 list-decimal list-inside mb-3"><li>点击上方的授权链接，在新页面中完成Google账号登录</li><li>点击“登录”按钮后可能会加载很慢（这是正常的）</li><li>如果超过1分钟还在加载，请按 F5 刷新页面</li><li>授权完成后会跳转到 http://localhost:45462 (可能显示无法访问)</li></ol><div class="bg-green-100 p-3 rounded border border-green-300"><p class="text-xs text-green-700"><i class="fas fa-lightbulb mr-1"></i><strong>提示：</strong>如果页面一直无法跳转，可以打开浏览器开发者工具（F12），F5刷新一下授权页再点击页面的登录按钮，在“网络”标签中找到以 localhost:45462 开头的请求，复制其完整URL。 </p></div></div></div></div>',1)),e("div",wt,[e("div",kt,[o[22]||(o[22]=e("div",{class:"w-6 h-6 bg-green-600 text-white rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0"},"3",-1)),e("div",ht,[o[20]||(o[20]=e("p",{class:"font-medium text-green-900 mb-2"},"复制oauth后的链接",-1)),o[21]||(o[21]=e("p",{class:"text-sm text-green-700 mb-3"}," 复制浏览器地址栏的完整链接并粘贴到下方输入框： ",-1)),e("div",Tt,[e("div",null,[o[18]||(o[18]=e("label",{class:"block text-sm font-semibold text-gray-700 mb-2"},[e("i",{class:"fas fa-key text-green-500 mr-2"}),y("复制oauth后的链接 ")],-1)),T(e("textarea",{"onUpdate:modelValue":o[1]||(o[1]=G=>U.value=G),rows:"3",class:"form-input w-full resize-none font-mono text-sm",placeholder:"粘贴以 http://localhost:45462 开头的完整链接..."},null,512),[[z,U.value]])]),o[19]||(o[19]=X('<div class="mt-2 space-y-1"><p class="text-xs text-gray-600"><i class="fas fa-check-circle text-green-500 mr-1"></i> 支持粘贴完整链接，系统会自动提取授权码 </p><p class="text-xs text-gray-600"><i class="fas fa-check-circle text-green-500 mr-1"></i> 也可以直接粘贴授权码（code参数的值） </p></div>',1))])])])])])])])])])):$("",!0),e("div",$t,[e("button",{type:"button",onClick:o[2]||(o[2]=G=>S.$emit("back")),class:"flex-1 px-6 py-3 bg-gray-100 text-gray-700 rounded-xl font-semibold hover:bg-gray-200 transition-colors"}," 上一步 "),e("button",{type:"button",onClick:I,disabled:!_.value||k.value,class:"btn btn-primary flex-1 py-3 px-6 font-semibold"},[k.value?(i(),u("div",At)):$("",!0),y(" "+A(k.value?"验证中...":"完成授权"),1)],8,Ct)])]))}},_t={key:0,class:"fixed inset-0 modal z-50 flex items-center justify-center p-4"},It={class:"modal-content w-full max-w-md p-6 mx-auto"},jt={class:"flex items-start gap-4 mb-6"},Vt={class:"flex-1"},St={class:"text-lg font-bold text-gray-900 mb-2"},Gt={class:"text-gray-600 text-sm leading-relaxed whitespace-pre-line"},Rt={class:"flex gap-3"},ke={__name:"ConfirmModal",props:{show:{type:Boolean,required:!0},title:{type:String,default:""},message:{type:String,default:""},confirmText:{type:String,default:"继续"},cancelText:{type:String,default:"取消"}},emits:["confirm","cancel"],setup(R){return(L,r)=>(i(),ee(ge,{to:"body"},[R.show?(i(),u("div",_t,[e("div",It,[e("div",jt,[r[2]||(r[2]=e("div",{class:"w-12 h-12 bg-gradient-to-br from-yellow-400 to-yellow-500 rounded-full flex items-center justify-center flex-shrink-0"},[e("i",{class:"fas fa-exclamation text-white text-xl"})],-1)),e("div",Vt,[e("h3",St,A(R.title),1),e("p",Gt,A(R.message),1)])]),e("div",Rt,[e("button",{onClick:r[0]||(r[0]=v=>L.$emit("cancel")),class:"flex-1 px-4 py-2.5 bg-gray-100 text-gray-700 rounded-xl font-medium hover:bg-gray-200 transition-colors"},A(R.cancelText),1),e("button",{onClick:r[1]||(r[1]=v=>L.$emit("confirm")),class:"flex-1 px-4 py-2.5 bg-gradient-to-r from-yellow-500 to-orange-500 text-white rounded-xl font-medium hover:from-yellow-600 hover:to-orange-600 transition-colors shadow-sm"},A(R.confirmText),1)])])])):$("",!0)]))}},Mt={key:0,class:"fixed inset-0 modal z-50 flex items-center justify-center p-4"},Pt={class:"modal-content w-full max-w-2xl p-8 mx-auto max-h-[90vh] overflow-y-auto custom-scrollbar"},Ot={class:"flex items-center justify-between mb-6"},Lt={class:"flex items-center gap-3"},zt={class:"text-xl font-bold text-gray-900"},Et={key:0,class:"flex items-center justify-center mb-8"},Dt={class:"flex items-center space-x-4"},Kt={class:"flex items-center"},Wt={class:"flex items-center"},qt={key:1},Bt={class:"space-y-6"},Nt={key:0},Ft={class:"flex gap-4"},Ht={class:"flex items-center cursor-pointer"},Jt={class:"flex items-center cursor-pointer"},Yt={key:1},Qt={class:"flex gap-4"},Xt={class:"flex items-center cursor-pointer"},Zt={class:"flex items-center cursor-pointer"},es={key:0,class:"text-red-500 text-xs mt-1"},ts={class:"flex gap-4"},ss={class:"flex items-center cursor-pointer"},ls={class:"flex items-center cursor-pointer"},as={key:2},os={key:3,class:"space-y-4 bg-blue-50 p-4 rounded-lg border border-blue-200"},ns={class:"flex items-start gap-3 mb-4"},rs={key:0,class:"text-sm text-blue-800 mb-2"},is={key:1,class:"text-sm text-blue-800 mb-2"},us={class:"bg-white/80 rounded-lg p-3 mt-2 mb-2 border border-blue-300"},ds={key:0,class:"text-xs text-blue-800"},cs={key:1,class:"text-xs text-blue-800"},ms={key:0,class:"text-red-500 text-xs mt-1"},ps={class:"flex gap-3 pt-4"},fs=["disabled"],xs=["disabled"],vs={key:0,class:"loading-spinner mr-2"},ys={key:3,class:"space-y-6"},gs={class:"flex gap-4"},bs={class:"flex items-center cursor-pointer"},ws={class:"flex items-center cursor-pointer"},ks={key:0},hs={class:"bg-amber-50 p-4 rounded-lg border border-amber-200"},Ts={class:"space-y-4"},$s={class:"flex gap-3 pt-4"},Cs=["disabled"],As={key:0,class:"loading-spinner mr-2"},ve={__name:"AccountForm",props:{account:{type:Object,default:null}},emits:["close","success"],setup(R,{emit:L}){var Q,m,d,h,W,te;const r=R,v=L,p=we(),{showConfirmModal:C,confirmOptions:k,showConfirm:g,handleConfirm:U,handleCancel:x}=be(),c=Z(()=>!!r.account),_=b(!0),P=b(1),j=b(!1),s=b({platform:((Q=r.account)==null?void 0:Q.platform)||"claude",addType:"oauth",name:((m=r.account)==null?void 0:m.name)||"",description:((d=r.account)==null?void 0:d.description)||"",accountType:((h=r.account)==null?void 0:h.accountType)||"shared",projectId:((W=r.account)==null?void 0:W.projectId)||"",accessToken:"",refreshToken:"",proxy:((te=r.account)==null?void 0:te.proxy)||{enabled:!1,type:"socks5",host:"",port:"",username:"",password:""}}),I=b({name:"",accessToken:""}),S=Z(()=>{var f;return((f=s.value.name)==null?void 0:f.trim())&&s.value.platform});Z(()=>{var f,t,a;return s.value.addType==="manual"?((f=s.value.name)==null?void 0:f.trim())&&((t=s.value.accessToken)==null?void 0:t.trim()):(a=s.value.name)==null?void 0:a.trim()});const o=async()=>{if(I.value.name="",!S.value){(!s.value.name||s.value.name.trim()==="")&&(I.value.name="请填写账户名称");return}s.value.platform==="gemini"&&P.value===1&&s.value.addType==="oauth"&&(!s.value.projectId||s.value.projectId.trim()==="")&&!await g("项目编号未填写",`您尚未填写项目编号。

如果您的Google账号绑定了Google Cloud或被识别为Workspace账号，需要提供项目编号。
如果您使用的是普通个人账号，可以继续不填写。`,"继续","返回填写")||(P.value=2)},G=async f=>{j.value=!0;try{const t={name:s.value.name,description:s.value.description,accountType:s.value.accountType,proxy:s.value.proxy.enabled?{type:s.value.proxy.type,host:s.value.proxy.host,port:parseInt(s.value.proxy.port),username:s.value.proxy.username||null,password:s.value.proxy.password||null}:null};s.value.platform==="claude"?t.claudeAiOauth=f.claudeAiOauth||f:s.value.platform==="gemini"&&(t.geminiOauth=f.tokens||f,s.value.projectId&&(t.projectId=s.value.projectId));let a;s.value.platform==="claude"?a=await p.createClaudeAccount(t):a=await p.createGeminiAccount(t),v("success",a)}catch(t){V(t.message||"账户创建失败","error")}finally{j.value=!1}},N=async()=>{I.value.name="",I.value.accessToken="";let f=!1;if((!s.value.name||s.value.name.trim()==="")&&(I.value.name="请填写账户名称",f=!0),s.value.addType==="manual"&&(!s.value.accessToken||s.value.accessToken.trim()==="")&&(I.value.accessToken="请填写 Access Token",f=!0),!f){j.value=!0;try{const t={name:s.value.name,description:s.value.description,accountType:s.value.accountType,proxy:s.value.proxy.enabled?{type:s.value.proxy.type,host:s.value.proxy.host,port:parseInt(s.value.proxy.port),username:s.value.proxy.username||null,password:s.value.proxy.password||null}:null};if(s.value.platform==="claude"){const l=s.value.refreshToken?6e5:31536e6;t.claudeAiOauth={accessToken:s.value.accessToken,refreshToken:s.value.refreshToken||"",expiresAt:Date.now()+l,scopes:["user:inference"]}}else if(s.value.platform==="gemini"){const l=s.value.refreshToken?6e5:31536e6;t.geminiOauth={access_token:s.value.accessToken,refresh_token:s.value.refreshToken||"",scope:"https://www.googleapis.com/auth/cloud-platform",token_type:"Bearer",expiry_date:Date.now()+l},s.value.projectId&&(t.projectId=s.value.projectId)}let a;s.value.platform==="claude"?a=await p.createClaudeAccount(t):a=await p.createGeminiAccount(t),v("success",a)}catch(t){V(t.message||"账户创建失败","error")}finally{j.value=!1}}},q=async()=>{if(I.value.name="",!s.value.name||s.value.name.trim()===""){I.value.name="请填写账户名称";return}if(!(s.value.platform==="gemini"&&(!s.value.projectId||s.value.projectId.trim()==="")&&!await g("项目编号未填写",`您尚未填写项目编号。

如果您的Google账号绑定了Google Cloud或被识别为Workspace账号，需要提供项目编号。
如果您使用的是普通个人账号，可以继续不填写。`,"继续保存","返回填写"))){j.value=!0;try{const f={name:s.value.name,description:s.value.description,accountType:s.value.accountType,proxy:s.value.proxy.enabled?{type:s.value.proxy.type,host:s.value.proxy.host,port:parseInt(s.value.proxy.port),username:s.value.proxy.username||null,password:s.value.proxy.password||null}:null};if(s.value.accessToken||s.value.refreshToken){if(r.account.platform==="claude"){const t=s.value.refreshToken?6e5:31536e6;f.claudeAiOauth={accessToken:s.value.accessToken||"",refreshToken:s.value.refreshToken||"",expiresAt:Date.now()+t,scopes:["user:inference"]}}else if(r.account.platform==="gemini"){const t=s.value.refreshToken?6e5:31536e6;f.geminiOauth={access_token:s.value.accessToken||"",refresh_token:s.value.refreshToken||"",scope:"https://www.googleapis.com/auth/cloud-platform",token_type:"Bearer",expiry_date:Date.now()+t}}}r.account.platform==="gemini"&&s.value.projectId&&(f.projectId=s.value.projectId),r.account.platform==="claude"?await p.updateClaudeAccount(r.account.id,f):await p.updateGeminiAccount(r.account.id,f),v("success")}catch(f){V(f.message||"账户更新失败","error")}finally{j.value=!1}}};return K(()=>s.value.name,()=>{var f;I.value.name&&((f=s.value.name)!=null&&f.trim())&&(I.value.name="")}),K(()=>s.value.accessToken,()=>{var f;I.value.accessToken&&((f=s.value.accessToken)!=null&&f.trim())&&(I.value.accessToken="")}),K(()=>r.account,f=>{f&&(s.value={platform:f.platform,addType:"oauth",name:f.name,description:f.description||"",accountType:f.accountType||"shared",projectId:f.projectId||"",accessToken:"",refreshToken:"",proxy:f.proxy||{enabled:!1,type:"socks5",host:"",port:"",username:"",password:""}})},{immediate:!0}),(f,t)=>(i(),ee(ge,{to:"body"},[_.value?(i(),u("div",Mt,[e("div",Pt,[e("div",Ot,[e("div",Lt,[t[24]||(t[24]=e("div",{class:"w-10 h-10 bg-gradient-to-br from-green-500 to-green-600 rounded-xl flex items-center justify-center"},[e("i",{class:"fas fa-user-circle text-white"})],-1)),e("h3",zt,A(c.value?"编辑账户":"添加账户"),1)]),e("button",{onClick:t[0]||(t[0]=a=>f.$emit("close")),class:"text-gray-400 hover:text-gray-600 transition-colors"},t[25]||(t[25]=[e("i",{class:"fas fa-times text-xl"},null,-1)]))]),!c.value&&s.value.addType==="oauth"?(i(),u("div",Et,[e("div",Dt,[e("div",Kt,[e("div",{class:E(["w-8 h-8 rounded-full flex items-center justify-center text-sm font-semibold",P.value>=1?"bg-blue-500 text-white":"bg-gray-200 text-gray-500"])}," 1 ",2),t[26]||(t[26]=e("span",{class:"ml-2 text-sm font-medium text-gray-700"},"基本信息",-1))]),t[28]||(t[28]=e("div",{class:"w-8 h-0.5 bg-gray-300"},null,-1)),e("div",Wt,[e("div",{class:E(["w-8 h-8 rounded-full flex items-center justify-center text-sm font-semibold",P.value>=2?"bg-blue-500 text-white":"bg-gray-200 text-gray-500"])}," 2 ",2),t[27]||(t[27]=e("span",{class:"ml-2 text-sm font-medium text-gray-700"},"授权认证",-1))])])])):$("",!0),P.value===1&&!c.value?(i(),u("div",qt,[e("div",Bt,[c.value?$("",!0):(i(),u("div",Nt,[t[31]||(t[31]=e("label",{class:"block text-sm font-semibold text-gray-700 mb-3"},"平台",-1)),e("div",Ft,[e("label",Ht,[T(e("input",{type:"radio","onUpdate:modelValue":t[1]||(t[1]=a=>s.value.platform=a),value:"claude",class:"mr-2"},null,512),[[J,s.value.platform]]),t[29]||(t[29]=e("span",{class:"text-sm text-gray-700"},"Claude",-1))]),e("label",Jt,[T(e("input",{type:"radio","onUpdate:modelValue":t[2]||(t[2]=a=>s.value.platform=a),value:"gemini",class:"mr-2"},null,512),[[J,s.value.platform]]),t[30]||(t[30]=e("span",{class:"text-sm text-gray-700"},"Gemini",-1))])])])),c.value?$("",!0):(i(),u("div",Yt,[t[34]||(t[34]=e("label",{class:"block text-sm font-semibold text-gray-700 mb-3"},"添加方式",-1)),e("div",Qt,[e("label",Xt,[T(e("input",{type:"radio","onUpdate:modelValue":t[3]||(t[3]=a=>s.value.addType=a),value:"oauth",class:"mr-2"},null,512),[[J,s.value.addType]]),t[32]||(t[32]=e("span",{class:"text-sm text-gray-700"},"OAuth 授权 (推荐)",-1))]),e("label",Zt,[T(e("input",{type:"radio","onUpdate:modelValue":t[4]||(t[4]=a=>s.value.addType=a),value:"manual",class:"mr-2"},null,512),[[J,s.value.addType]]),t[33]||(t[33]=e("span",{class:"text-sm text-gray-700"},"手动输入 Access Token",-1))])])])),e("div",null,[t[35]||(t[35]=e("label",{class:"block text-sm font-semibold text-gray-700 mb-3"},"账户名称",-1)),T(e("input",{"onUpdate:modelValue":t[5]||(t[5]=a=>s.value.name=a),type:"text",required:"",class:E(["form-input w-full",{"border-red-500":I.value.name}]),placeholder:"为账户设置一个易识别的名称"},null,2),[[z,s.value.name]]),I.value.name?(i(),u("p",es,A(I.value.name),1)):$("",!0)]),e("div",null,[t[36]||(t[36]=e("label",{class:"block text-sm font-semibold text-gray-700 mb-3"},"描述 (可选)",-1)),T(e("textarea",{"onUpdate:modelValue":t[6]||(t[6]=a=>s.value.description=a),rows:"3",class:"form-input w-full resize-none",placeholder:"账户用途说明..."},null,512),[[z,s.value.description]])]),e("div",null,[t[39]||(t[39]=e("label",{class:"block text-sm font-semibold text-gray-700 mb-3"},"账户类型",-1)),e("div",ts,[e("label",ss,[T(e("input",{type:"radio","onUpdate:modelValue":t[7]||(t[7]=a=>s.value.accountType=a),value:"shared",class:"mr-2"},null,512),[[J,s.value.accountType]]),t[37]||(t[37]=e("span",{class:"text-sm text-gray-700"},"共享账户",-1))]),e("label",ls,[T(e("input",{type:"radio","onUpdate:modelValue":t[8]||(t[8]=a=>s.value.accountType=a),value:"dedicated",class:"mr-2"},null,512),[[J,s.value.accountType]]),t[38]||(t[38]=e("span",{class:"text-sm text-gray-700"},"专属账户",-1))])]),t[40]||(t[40]=e("p",{class:"text-xs text-gray-500 mt-2"}," 共享账户：供所有API Key使用；专属账户：仅供特定API Key使用 ",-1))]),s.value.platform==="gemini"?(i(),u("div",as,[t[41]||(t[41]=e("label",{class:"block text-sm font-semibold text-gray-700 mb-3"},"项目编号 (可选)",-1)),T(e("input",{"onUpdate:modelValue":t[9]||(t[9]=a=>s.value.projectId=a),type:"text",class:"form-input w-full",placeholder:"例如：123456789012（纯数字）"},null,512),[[z,s.value.projectId]]),t[42]||(t[42]=e("div",{class:"mt-2 p-3 bg-yellow-50 border border-yellow-200 rounded-lg"},[e("div",{class:"flex items-start gap-2"},[e("i",{class:"fas fa-info-circle text-yellow-600 mt-0.5"}),e("div",{class:"text-xs text-yellow-700"},[e("p",{class:"font-medium mb-1"},"Google Cloud/Workspace 账号需要提供项目编号"),e("p",null,"某些 Google 账号（特别是绑定了 Google Cloud 的账号）会被识别为 Workspace 账号，需要提供额外的项目编号。"),e("div",{class:"mt-2 p-2 bg-white rounded border border-yellow-300"},[e("p",{class:"font-medium mb-1"},"如何获取项目编号："),e("ol",{class:"list-decimal list-inside space-y-1 ml-2"},[e("li",null,[y("访问 "),e("a",{href:"https://console.cloud.google.com/welcome",target:"_blank",class:"text-blue-600 hover:underline font-medium"},"Google Cloud Console")]),e("li",null,[y("复制"),e("span",{class:"font-semibold text-red-600"},"项目编号（Project Number）"),y("，通常是12位纯数字")]),e("li",{class:"text-red-600"},"⚠️ 注意：不要复制项目ID（Project ID），要复制项目编号！")])]),e("p",{class:"mt-2"},[e("strong",null,"提示："),y("如果您的账号是普通个人账号（未绑定 Google Cloud），请留空此字段。")])])])],-1))])):$("",!0),s.value.addType==="manual"?(i(),u("div",os,[e("div",ns,[t[48]||(t[48]=e("div",{class:"w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center flex-shrink-0 mt-1"},[e("i",{class:"fas fa-info text-white text-sm"})],-1)),e("div",null,[t[46]||(t[46]=e("h5",{class:"font-semibold text-blue-900 mb-2"},"手动输入 Token",-1)),s.value.platform==="claude"?(i(),u("p",rs," 请输入有效的 Claude Access Token。如果您有 Refresh Token，建议也一并填写以支持自动刷新。 ")):s.value.platform==="gemini"?(i(),u("p",is," 请输入有效的 Gemini Access Token。如果您有 Refresh Token，建议也一并填写以支持自动刷新。 ")):$("",!0),e("div",us,[t[45]||(t[45]=e("p",{class:"text-sm text-blue-900 font-medium mb-1"},[e("i",{class:"fas fa-folder-open mr-1"}),y(" 获取 Access Token 的方法： ")],-1)),s.value.platform==="claude"?(i(),u("p",ds,t[43]||(t[43]=[y(" 请从已登录 Claude Code 的机器上获取 ",-1),e("code",{class:"bg-blue-100 px-1 py-0.5 rounded font-mono"},"~/.claude/.credentials.json",-1),y(" 文件中的凭证， 请勿使用 Claude 官网 API Keys 页面的密钥。 ",-1)]))):s.value.platform==="gemini"?(i(),u("p",cs,t[44]||(t[44]=[y(" 请从已登录 Gemini CLI 的机器上获取 ",-1),e("code",{class:"bg-blue-100 px-1 py-0.5 rounded font-mono"},"~/.config/gemini/credentials.json",-1),y(" 文件中的凭证。 ",-1)]))):$("",!0)]),t[47]||(t[47]=e("p",{class:"text-xs text-blue-600"},"💡 如果未填写 Refresh Token，Token 过期后需要手动更新。",-1))])]),e("div",null,[t[49]||(t[49]=e("label",{class:"block text-sm font-semibold text-gray-700 mb-3"},"Access Token *",-1)),T(e("textarea",{"onUpdate:modelValue":t[10]||(t[10]=a=>s.value.accessToken=a),rows:"4",required:"",class:E(["form-input w-full resize-none font-mono text-xs",{"border-red-500":I.value.accessToken}]),placeholder:"请输入 Access Token..."},null,2),[[z,s.value.accessToken]]),I.value.accessToken?(i(),u("p",ms,A(I.value.accessToken),1)):$("",!0)]),e("div",null,[t[50]||(t[50]=e("label",{class:"block text-sm font-semibold text-gray-700 mb-3"},"Refresh Token (可选)",-1)),T(e("textarea",{"onUpdate:modelValue":t[11]||(t[11]=a=>s.value.refreshToken=a),rows:"4",class:"form-input w-full resize-none font-mono text-xs",placeholder:"请输入 Refresh Token..."},null,512),[[z,s.value.refreshToken]])])])):$("",!0),le(xe,{modelValue:s.value.proxy,"onUpdate:modelValue":t[12]||(t[12]=a=>s.value.proxy=a)},null,8,["modelValue"]),e("div",ps,[e("button",{type:"button",onClick:t[13]||(t[13]=a=>f.$emit("close")),class:"flex-1 px-6 py-3 bg-gray-100 text-gray-700 rounded-xl font-semibold hover:bg-gray-200 transition-colors"}," 取消 "),s.value.addType==="oauth"?(i(),u("button",{key:0,type:"button",onClick:o,disabled:j.value,class:"btn btn-primary flex-1 py-3 px-6 font-semibold"}," 下一步 ",8,fs)):(i(),u("button",{key:1,type:"button",onClick:N,disabled:j.value,class:"btn btn-primary flex-1 py-3 px-6 font-semibold"},[j.value?(i(),u("div",vs)):$("",!0),y(" "+A(j.value?"创建中...":"创建"),1)],8,xs))])])])):$("",!0),P.value===2&&s.value.addType==="oauth"?(i(),ee(Ut,{key:2,platform:s.value.platform,proxy:s.value.proxy,onSuccess:G,onBack:t[14]||(t[14]=a=>P.value=1)},null,8,["platform","proxy"])):$("",!0),c.value?(i(),u("div",ys,[e("div",null,[t[51]||(t[51]=e("label",{class:"block text-sm font-semibold text-gray-700 mb-3"},"账户名称",-1)),T(e("input",{"onUpdate:modelValue":t[15]||(t[15]=a=>s.value.name=a),type:"text",required:"",class:"form-input w-full",placeholder:"为账户设置一个易识别的名称"},null,512),[[z,s.value.name]])]),e("div",null,[t[52]||(t[52]=e("label",{class:"block text-sm font-semibold text-gray-700 mb-3"},"描述 (可选)",-1)),T(e("textarea",{"onUpdate:modelValue":t[16]||(t[16]=a=>s.value.description=a),rows:"3",class:"form-input w-full resize-none",placeholder:"账户用途说明..."},null,512),[[z,s.value.description]])]),e("div",null,[t[55]||(t[55]=e("label",{class:"block text-sm font-semibold text-gray-700 mb-3"},"账户类型",-1)),e("div",gs,[e("label",bs,[T(e("input",{type:"radio","onUpdate:modelValue":t[17]||(t[17]=a=>s.value.accountType=a),value:"shared",class:"mr-2"},null,512),[[J,s.value.accountType]]),t[53]||(t[53]=e("span",{class:"text-sm text-gray-700"},"共享账户",-1))]),e("label",ws,[T(e("input",{type:"radio","onUpdate:modelValue":t[18]||(t[18]=a=>s.value.accountType=a),value:"dedicated",class:"mr-2"},null,512),[[J,s.value.accountType]]),t[54]||(t[54]=e("span",{class:"text-sm text-gray-700"},"专属账户",-1))])]),t[56]||(t[56]=e("p",{class:"text-xs text-gray-500 mt-2"}," 共享账户：供所有API Key使用；专属账户：仅供特定API Key使用 ",-1))]),s.value.platform==="gemini"?(i(),u("div",ks,[t[57]||(t[57]=e("label",{class:"block text-sm font-semibold text-gray-700 mb-3"},"项目编号 (可选)",-1)),T(e("input",{"onUpdate:modelValue":t[19]||(t[19]=a=>s.value.projectId=a),type:"text",class:"form-input w-full",placeholder:"例如：123456789012（纯数字）"},null,512),[[z,s.value.projectId]]),t[58]||(t[58]=e("p",{class:"text-xs text-gray-500 mt-2"}," Google Cloud/Workspace 账号可能需要提供项目编号 ",-1))])):$("",!0),e("div",hs,[t[61]||(t[61]=e("div",{class:"flex items-start gap-3 mb-4"},[e("div",{class:"w-8 h-8 bg-amber-500 rounded-lg flex items-center justify-center flex-shrink-0 mt-1"},[e("i",{class:"fas fa-key text-white text-sm"})]),e("div",null,[e("h5",{class:"font-semibold text-amber-900 mb-2"},"更新 Token"),e("p",{class:"text-sm text-amber-800 mb-2"},"可以更新 Access Token 和 Refresh Token。为了安全起见，不会显示当前的 Token 值。"),e("p",{class:"text-xs text-amber-600"},"💡 留空表示不更新该字段。")])],-1)),e("div",Ts,[e("div",null,[t[59]||(t[59]=e("label",{class:"block text-sm font-semibold text-gray-700 mb-3"},"新的 Access Token",-1)),T(e("textarea",{"onUpdate:modelValue":t[20]||(t[20]=a=>s.value.accessToken=a),rows:"4",class:"form-input w-full resize-none font-mono text-xs",placeholder:"留空表示不更新..."},null,512),[[z,s.value.accessToken]])]),e("div",null,[t[60]||(t[60]=e("label",{class:"block text-sm font-semibold text-gray-700 mb-3"},"新的 Refresh Token",-1)),T(e("textarea",{"onUpdate:modelValue":t[21]||(t[21]=a=>s.value.refreshToken=a),rows:"4",class:"form-input w-full resize-none font-mono text-xs",placeholder:"留空表示不更新..."},null,512),[[z,s.value.refreshToken]])])])]),le(xe,{modelValue:s.value.proxy,"onUpdate:modelValue":t[22]||(t[22]=a=>s.value.proxy=a)},null,8,["modelValue"]),e("div",$s,[e("button",{type:"button",onClick:t[23]||(t[23]=a=>f.$emit("close")),class:"flex-1 px-6 py-3 bg-gray-100 text-gray-700 rounded-xl font-semibold hover:bg-gray-200 transition-colors"}," 取消 "),e("button",{type:"button",onClick:q,disabled:j.value,class:"btn btn-primary flex-1 py-3 px-6 font-semibold"},[j.value?(i(),u("div",As)):$("",!0),y(" "+A(j.value?"更新中...":"更新"),1)],8,Cs)])])):$("",!0)])])):$("",!0),le(ke,{show:D(C),title:D(k).title,message:D(k).message,"confirm-text":D(k).confirmText,"cancel-text":D(k).cancelText,onConfirm:D(U),onCancel:D(x)},null,8,["show","title","message","confirm-text","cancel-text","onConfirm","onCancel"])]))}},Us={class:"accounts-container"},_s={class:"card p-6"},Is={class:"flex flex-col md:flex-row justify-between items-center gap-4 mb-6"},js={class:"flex gap-2"},Vs={key:0,class:"text-center py-12"},Ss={key:1,class:"text-center py-12"},Gs={key:2,class:"table-container"},Rs={class:"min-w-full"},Ms={class:"bg-gray-50/80 backdrop-blur-sm"},Ps={key:1,class:"fas fa-sort ml-1 text-gray-400"},Os={key:1,class:"fas fa-sort ml-1 text-gray-400"},Ls={key:1,class:"fas fa-sort ml-1 text-gray-400"},zs={key:1,class:"fas fa-sort ml-1 text-gray-400"},Es={class:"divide-y divide-gray-200/50"},Ds={class:"px-6 py-4 whitespace-nowrap"},Ks={class:"flex items-center"},Ws={class:"flex items-center gap-2"},qs={class:"text-sm font-semibold text-gray-900"},Bs={key:0,class:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800"},Ns={key:1,class:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"},Fs={class:"text-xs text-gray-500"},Hs={class:"px-6 py-4 whitespace-nowrap"},Js={key:0,class:"inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-yellow-100 text-yellow-800"},Ys={key:1,class:"inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-indigo-100 text-indigo-800"},Qs={class:"px-6 py-4 whitespace-nowrap"},Xs={key:0,class:"inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-blue-100 text-blue-800"},Zs={key:1,class:"inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-orange-100 text-orange-800"},el={class:"px-6 py-4 whitespace-nowrap"},tl={class:"flex flex-col gap-1"},sl={key:0,class:"inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-yellow-100 text-yellow-800"},ll={key:1,class:"text-xs text-gray-500"},al={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-600"},ol={key:0,class:"text-xs bg-blue-50 px-2 py-1 rounded"},nl={key:1,class:"text-gray-400"},rl={class:"px-6 py-4 whitespace-nowrap text-sm"},il={key:0,class:"space-y-1"},ul={class:"flex items-center gap-2"},dl={class:"text-sm font-medium text-gray-900"},cl={class:"flex items-center gap-2"},ml={class:"text-xs text-gray-600"},pl={key:0,class:"text-xs text-gray-500"},fl={key:1,class:"text-gray-400 text-xs"},xl={class:"px-6 py-4 whitespace-nowrap"},vl={key:0,class:"space-y-2"},yl={class:"flex items-center gap-2"},gl={class:"w-24 bg-gray-200 rounded-full h-2"},bl={class:"text-xs text-gray-700 font-medium min-w-[32px]"},wl={class:"text-xs text-gray-600"},kl={key:0,class:"text-indigo-600 font-medium"},hl={key:1,class:"text-gray-400 text-sm"},Tl={key:2,class:"text-gray-400 text-sm"},$l={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-600"},Cl={class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},Al={class:"flex items-center gap-2"},Ul=["onClick","disabled","title"],_l=["onClick"],Il=["onClick"],jl={__name:"AccountsView",setup(R){const{showConfirmModal:L,confirmOptions:r,showConfirm:v,handleConfirm:p,handleCancel:C}=be(),k=b([]),g=b(!1),U=b("name"),x=b(""),c=b("asc"),_=b([]),P=b(!1),j=b(!1),s=b(null),I=Z(()=>x.value?[...k.value].sort((l,n)=>{var B,F,H,ae,oe,ne,re,ie,ue,de,ce,me;let w=l[x.value],O=n[x.value];return x.value==="dailyTokens"?(w=((F=(B=l.usage)==null?void 0:B.daily)==null?void 0:F.allTokens)||0,O=((ae=(H=n.usage)==null?void 0:H.daily)==null?void 0:ae.allTokens)||0):x.value==="dailyRequests"?(w=((ne=(oe=l.usage)==null?void 0:oe.daily)==null?void 0:ne.requests)||0,O=((ie=(re=n.usage)==null?void 0:re.daily)==null?void 0:ie.requests)||0):x.value==="totalTokens"&&(w=((de=(ue=l.usage)==null?void 0:ue.total)==null?void 0:de.allTokens)||0,O=((me=(ce=n.usage)==null?void 0:ce.total)==null?void 0:me.allTokens)||0),x.value==="lastUsed"&&(w=l.lastUsedAt?new Date(l.lastUsedAt).getTime():0,O=n.lastUsedAt?new Date(n.lastUsedAt).getTime():0),x.value==="status"&&(w=l.isActive?1:0,O=n.isActive?1:0),w<O?c.value==="asc"?-1:1:w>O?c.value==="asc"?1:-1:0}):k.value),S=async()=>{g.value=!0;try{const[a,l,n]=await Promise.all([M.get("/admin/claude-accounts"),M.get("/admin/gemini-accounts"),M.get("/admin/api-keys")]);n.success&&(_.value=n.data||[]);const w=[];if(a.success){const O=(a.data||[]).map(B=>{const F=_.value.filter(H=>H.claudeAccountId===B.id).length;return{...B,platform:"claude",boundApiKeysCount:F}});w.push(...O)}if(l.success){const O=(l.data||[]).map(B=>{const F=_.value.filter(H=>H.geminiAccountId===B.id).length;return{...B,platform:"gemini",boundApiKeysCount:F}});w.push(...O)}k.value=w}catch{V("加载账户失败","error")}finally{g.value=!1}},o=a=>{a&&(x.value===a?c.value=c.value==="asc"?"desc":"asc":(x.value=a,c.value="asc"))},G=a=>{if(a==null)return"0";const l=Number(a);return l>=1e6?Math.floor(l/1e6).toLocaleString()+"M":l.toLocaleString()},N=a=>{if(!a)return"从未使用";const l=new Date(a),w=new Date-l;return w<6e4?"刚刚":w<36e5?`${Math.floor(w/6e4)} 分钟前`:w<864e5?`${Math.floor(w/36e5)} 小时前`:w<6048e5?`${Math.floor(w/864e5)} 天前`:l.toLocaleDateString("zh-CN")},q=async()=>{try{const a=await M.get("/admin/api-keys");a.success&&(_.value=a.data)}catch(a){console.error("Failed to load API keys:",a)}},Q=(a,l)=>{if(!a||!l)return"--";const n=new Date(a),w=new Date(l),O=n.getHours().toString().padStart(2,"0"),B=n.getMinutes().toString().padStart(2,"0"),F=w.getHours().toString().padStart(2,"0"),H=w.getMinutes().toString().padStart(2,"0");return`${O}:${B} - ${F}:${H}`},m=a=>{if(!a||a<=0)return"已结束";const l=Math.floor(a/60),n=a%60;return l>0?`${l}小时${n}分钟`:`${n}分钟`},d=()=>{P.value=!0},h=a=>{s.value=a,j.value=!0},W=async a=>{const l=_.value.filter(w=>w.claudeAccountId===a.id||w.geminiAccountId===a.id).length;if(l>0){V(`无法删除此账号，有 ${l} 个API Key绑定到此账号，请先解绑所有API Key`,"error");return}if(await v("删除账户",`确定要删除账户 "${a.name}" 吗？

此操作不可恢复。`,"删除","取消"))try{const w=a.platform==="claude"?`/admin/claude-accounts/${a.id}`:`/admin/gemini-accounts/${a.id}`,O=await M.delete(w);O.success?(V("账户已删除","success"),S()):V(O.message||"删除失败","error")}catch{V("删除失败","error")}},te=async a=>{if(!a.isRefreshing)try{a.isRefreshing=!0;const l=await M.post(`/admin/claude-accounts/${a.id}/refresh`);l.success?(V("Token刷新成功","success"),S()):V(l.message||"Token刷新失败","error")}catch{V("Token刷新失败","error")}finally{a.isRefreshing=!1}},f=()=>{P.value=!1,V("账户创建成功","success"),S()},t=()=>{j.value=!1,V("账户更新成功","success"),S()};return K(U,a=>{const l={name:"name",dailyTokens:"dailyTokens",dailyRequests:"dailyRequests",totalTokens:"totalTokens",lastUsed:"lastUsed"};l[a]&&o(l[a])}),Ce(()=>{S(),q()}),(a,l)=>(i(),u("div",Us,[e("div",_s,[e("div",Is,[l[10]||(l[10]=e("div",null,[e("h3",{class:"text-xl font-bold text-gray-900 mb-2"},"账户管理"),e("p",{class:"text-gray-600"},"管理您的 Claude 和 Gemini 账户及代理配置")],-1)),e("div",js,[T(e("select",{"onUpdate:modelValue":l[0]||(l[0]=n=>U.value=n),onChange:l[1]||(l[1]=n=>o()),class:"form-input px-3 py-2 text-sm"},l[8]||(l[8]=[X('<option value="name" data-v-83f9b84d>按名称排序</option><option value="dailyTokens" data-v-83f9b84d>按今日Token排序</option><option value="dailyRequests" data-v-83f9b84d>按今日请求数排序</option><option value="totalTokens" data-v-83f9b84d>按总Token排序</option><option value="lastUsed" data-v-83f9b84d>按最后使用排序</option>',5)]),544),[[ye,U.value]]),e("button",{onClick:Ae(d,["stop"]),class:"btn btn-success px-6 py-3 flex items-center gap-2"},l[9]||(l[9]=[e("i",{class:"fas fa-plus"},null,-1),y("添加账户 ",-1)]))])]),g.value?(i(),u("div",Vs,l[11]||(l[11]=[e("div",{class:"loading-spinner mx-auto mb-4"},null,-1),e("p",{class:"text-gray-500"},"正在加载账户...",-1)]))):I.value.length===0?(i(),u("div",Ss,l[12]||(l[12]=[e("div",{class:"w-16 h-16 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center"},[e("i",{class:"fas fa-user-circle text-gray-400 text-xl"})],-1),e("p",{class:"text-gray-500 text-lg"},"暂无账户",-1),e("p",{class:"text-gray-400 text-sm mt-2"},"点击上方按钮添加您的第一个账户",-1)]))):(i(),u("div",Gs,[e("table",Rs,[e("thead",Ms,[e("tr",null,[e("th",{class:"px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:l[2]||(l[2]=n=>o("name"))},[l[13]||(l[13]=y(" 名称 ",-1)),x.value==="name"?(i(),u("i",{key:0,class:E(["fas",c.value==="asc"?"fa-sort-up":"fa-sort-down","ml-1"])},null,2)):(i(),u("i",Ps))]),e("th",{class:"px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:l[3]||(l[3]=n=>o("platform"))},[l[14]||(l[14]=y(" 平台 ",-1)),x.value==="platform"?(i(),u("i",{key:0,class:E(["fas",c.value==="asc"?"fa-sort-up":"fa-sort-down","ml-1"])},null,2)):(i(),u("i",Os))]),e("th",{class:"px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:l[4]||(l[4]=n=>o("accountType"))},[l[15]||(l[15]=y(" 类型 ",-1)),x.value==="accountType"?(i(),u("i",{key:0,class:E(["fas",c.value==="asc"?"fa-sort-up":"fa-sort-down","ml-1"])},null,2)):(i(),u("i",Ls))]),e("th",{class:"px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:l[5]||(l[5]=n=>o("status"))},[l[16]||(l[16]=y(" 状态 ",-1)),x.value==="status"?(i(),u("i",{key:0,class:E(["fas",c.value==="asc"?"fa-sort-up":"fa-sort-down","ml-1"])},null,2)):(i(),u("i",zs))]),l[17]||(l[17]=e("th",{class:"px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider"},"代理",-1)),l[18]||(l[18]=e("th",{class:"px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider"},"今日使用",-1)),l[19]||(l[19]=e("th",{class:"px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider"},"会话窗口",-1)),l[20]||(l[20]=e("th",{class:"px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider"},"最后使用",-1)),l[21]||(l[21]=e("th",{class:"px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider"},"操作",-1))])]),e("tbody",Es,[(i(!0),u(Ue,null,_e(I.value,n=>(i(),u("tr",{key:n.id,class:"table-row"},[e("td",Ds,[e("div",Ks,[l[24]||(l[24]=e("div",{class:"w-8 h-8 bg-gradient-to-br from-green-500 to-green-600 rounded-lg flex items-center justify-center mr-3"},[e("i",{class:"fas fa-user-circle text-white text-xs"})],-1)),e("div",null,[e("div",Ws,[e("div",qs,A(n.name),1),n.accountType==="dedicated"?(i(),u("span",Bs,l[22]||(l[22]=[e("i",{class:"fas fa-lock mr-1"},null,-1),y("专属 ",-1)]))):(i(),u("span",Ns,l[23]||(l[23]=[e("i",{class:"fas fa-share-alt mr-1"},null,-1),y("共享 ",-1)])))]),e("div",Fs,A(n.id),1)])])]),e("td",Hs,[n.platform==="gemini"?(i(),u("span",Js,l[25]||(l[25]=[e("i",{class:"fas fa-robot mr-1"},null,-1),y("Gemini ",-1)]))):(i(),u("span",Ys,l[26]||(l[26]=[e("i",{class:"fas fa-brain mr-1"},null,-1),y("Claude ",-1)])))]),e("td",Qs,[n.scopes&&n.scopes.length>0?(i(),u("span",Xs,l[27]||(l[27]=[e("i",{class:"fas fa-lock mr-1"},null,-1),y("OAuth ",-1)]))):(i(),u("span",Zs,l[28]||(l[28]=[e("i",{class:"fas fa-key mr-1"},null,-1),y("传统 ",-1)])))]),e("td",el,[e("div",tl,[e("span",{class:E(["inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold",n.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},[e("div",{class:E(["w-2 h-2 rounded-full mr-2",n.isActive?"bg-green-500":"bg-red-500"])},null,2),y(" "+A(n.isActive?"正常":"异常"),1)],2),n.rateLimitStatus&&n.rateLimitStatus.isRateLimited?(i(),u("span",sl,[l[29]||(l[29]=e("i",{class:"fas fa-exclamation-triangle mr-1"},null,-1)),y(" 限流中 ("+A(n.rateLimitStatus.minutesRemaining)+"分钟) ",1)])):$("",!0),n.accountType==="dedicated"?(i(),u("span",ll," 绑定: "+A(n.boundApiKeysCount||0)+" 个API Key ",1)):$("",!0)])]),e("td",al,[n.proxy?(i(),u("div",ol,A(n.proxy.type)+"://"+A(n.proxy.host)+":"+A(n.proxy.port),1)):(i(),u("div",nl,"无代理"))]),e("td",rl,[n.usage&&n.usage.daily?(i(),u("div",il,[e("div",ul,[l[30]||(l[30]=e("div",{class:"w-2 h-2 bg-green-500 rounded-full"},null,-1)),e("span",dl,A(n.usage.daily.requests||0)+" 次",1)]),e("div",cl,[l[31]||(l[31]=e("div",{class:"w-2 h-2 bg-blue-500 rounded-full"},null,-1)),e("span",ml,A(G(n.usage.daily.allTokens||0))+" tokens",1)]),n.usage.averages&&n.usage.averages.rpm>0?(i(),u("div",pl," 平均 "+A(n.usage.averages.rpm.toFixed(2))+" RPM ",1)):$("",!0)])):(i(),u("div",fl,"暂无数据"))]),e("td",xl,[n.platform==="claude"&&n.sessionWindow&&n.sessionWindow.hasActiveWindow?(i(),u("div",vl,[e("div",yl,[e("div",gl,[e("div",{class:"bg-gradient-to-r from-blue-500 to-indigo-600 h-2 rounded-full transition-all duration-300",style:Ie({width:n.sessionWindow.progress+"%"})},null,4)]),e("span",bl,A(n.sessionWindow.progress)+"% ",1)]),e("div",wl,[e("div",null,A(Q(n.sessionWindow.windowStart,n.sessionWindow.windowEnd)),1),n.sessionWindow.remainingTime>0?(i(),u("div",kl," 剩余 "+A(m(n.sessionWindow.remainingTime)),1)):$("",!0)])])):n.platform==="claude"?(i(),u("div",hl,l[32]||(l[32]=[e("i",{class:"fas fa-minus"},null,-1)]))):(i(),u("div",Tl,l[33]||(l[33]=[e("span",{class:"text-xs"},"N/A",-1)])))]),e("td",$l,A(N(n.lastUsedAt)),1),e("td",Cl,[e("div",Al,[n.platform==="claude"&&n.scopes?(i(),u("button",{key:0,onClick:w=>te(n),disabled:n.isRefreshing,class:E(["px-3 py-1.5 rounded-lg text-xs font-medium transition-colors",n.isRefreshing?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-blue-100 text-blue-700 hover:bg-blue-200"]),title:n.isRefreshing?"刷新中...":"刷新Token"},[e("i",{class:E(["fas fa-sync-alt",n.isRefreshing?"animate-spin":""])},null,2)],10,Ul)):$("",!0),e("button",{onClick:w=>h(n),class:"px-3 py-1.5 bg-blue-100 text-blue-700 rounded-lg text-xs font-medium hover:bg-blue-200 transition-colors"},l[34]||(l[34]=[e("i",{class:"fas fa-edit"},null,-1)]),8,_l),e("button",{onClick:w=>W(n),class:"px-3 py-1.5 bg-red-100 text-red-700 rounded-lg text-xs font-medium hover:bg-red-200 transition-colors"},l[35]||(l[35]=[e("i",{class:"fas fa-trash"},null,-1)]),8,Il)])])]))),128))])])]))]),P.value?(i(),ee(ve,{key:0,onClose:l[6]||(l[6]=n=>P.value=!1),onSuccess:f})):$("",!0),j.value?(i(),ee(ve,{key:1,account:s.value,onClose:l[7]||(l[7]=n=>j.value=!1),onSuccess:t},null,8,["account"])):$("",!0),le(ke,{show:D(L),title:D(r).title,message:D(r).message,"confirm-text":D(r).confirmText,"cancel-text":D(r).cancelText,onConfirm:D(p),onCancel:D(C)},null,8,["show","title","message","confirm-text","cancel-text","onConfirm","onCancel"])]))}},Pl=je(jl,[["__scopeId","data-v-83f9b84d"]]);export{Pl as default};
